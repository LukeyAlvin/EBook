**为什么要有 TCP/IP ⽹络模型？**

对于同⼀台设备上的进程间通信，有很多种⽅式，⽐如有管道、消息队列、共享内存、信号等⽅式，⽽对于不同设备上的进程间通信，就需要⽹络通信，⽽设备是多样性的，所以要兼容多种多样的设备，就协商出了⼀套通⽤的⽹络协议。

**什么是 TCP ? UDP？**

TCP 的全称叫**传输控制协议**（Transmission Control Protocol），⼤部分应⽤使⽤的正是 TCP 传输层协议，⽐如 **HTTP 应⽤层协议**。TCP 相⽐ UDP 多了很多特性，⽐如**流量控制、超时重传、拥塞控制**等，这些都是为了保证数据包能可靠地传输给对⽅。

UDP  的全称叫用户数据报协议（User Datagram Protocol），它相对来说就很简单，简单到**只负责发送数据包，不保证数据包是否能抵达对⽅，但它实时性相对更好，传输效率也⾼**。

**什么是端口？**

当设备作为接收⽅时，传输层则要负责把数据包传给应⽤，但是⼀台设备上可能会有很多应⽤在接收或者传输数据，因此需要⽤⼀个编号将应⽤区分开来，这个编号就是端⼝。⽐如 80 端⼝通常是 Web 服务器⽤的，22 端⼝通常是远程登录服务器⽤的。⽽对于浏览器（客户端）中的每个标签栏都是⼀个独⽴的进程，操作系统会为这些进程分配临时的端⼝号。由于**传输层的报⽂中会携带端⼝号**，因此接收⽅可以识别出该报⽂是发送给哪个应⽤

**⽹络层负责将数据从⼀个设备传输到另⼀个设备，怎样区分和寻找设备？**

⼀般⽤ IP 地址给设备进⾏编号，对于 IPv4 协议， IP 地址共 32 位，分成了四段（⽐如，192.168.100.1），每段是 8 位。只有⼀个单纯的 IP 地址虽然做到了区分设备，但是寻址起来就特别麻烦，因此，需要将 IP 地址分成两种意义：

- ⼀个是**⽹络号**，负责标识该 IP 地址是属于哪个「⼦⽹」的；
- ⼀个是**主机号**，负责标识同⼀「⼦⽹」下的不同主机；

这需要配合**⼦⽹掩码**才能算出 IP 地址 的⽹络号和主机号。⽐如 `10.100.122.0/24`，后⾯的 `/24` （24 个1）表示就是`255.255.255.0` ⼦⽹掩码，将 `10.100.122.2` 和 `255.255.255.0` 进⾏**按位与运算**，就可以得到**⽹络号**，

<img src="/home/alivn/Documents/算法与面试/images/Blog/计算机网络/image-20230308160959114.png" alt="image-20230308160959114" style="zoom:30%;" />

将 `255.255.255.0` 取反后与 IP地址进⾏进⾏**按位与运算**，就可以得到**主机号**。[子网掩码计算器](https://www.sojson.com/convert/subnetmask.html)

除了寻址能⼒， IP 协议还有另⼀个重要的能⼒就是**路由**。实际场景中，两台设备并不是⽤⼀条⽹线连接起来的，⽽是通过很多⽹关、路由器、交换机等众多⽹络设备连接起来的，那么就会形成很多条⽹络的路径，因此当数据包到达⼀个⽹络节点，就需要通过路由算法决定下⼀步⾛哪条路径。

所以，**IP 协议的寻址作⽤是告诉我们去往下⼀个⽬的地该朝哪个⽅向⾛，路由则是根据「下⼀个⽬的地」选择路径。寻址更像在导航，路由更像在操作⽅向盘。**

<img src="/home/alivn/Documents/算法与面试/images/Blog/计算机网络/image-20230308161836478.png" alt="image-20230308161836478" style="zoom:33%;" />

**什么是以太网？**

电脑上的以太⽹接⼝，Wi-Fi接⼝，以太⽹交换机、路由器上的千兆，万兆以太⽹⼝，还有⽹线，它们都是以太⽹的组成部分。以太⽹就是⼀种在「局域⽹」内，把附近的设备连接起来，使它们之间可以进⾏通讯的技术。

**TCP 的三次握手？**

TCP（Transmission Control Protocol）是一种面向连接的、可靠的传输协议，其在数据传输之前需要通过三次握手建立连接。

三次握手的过程如下：

1. 第一次握手：客户端向服务器发送连接请求（SYN），并指定一个初始化序列号（ISN）。
2. 第二次握手：服务器收到客户端的连接请求，并回复一个确认消息（ACK），同时也向客户端发送一个SYN请求。
3. 第三次握手：客户端收到服务器的SYN请求后，回复一个ACK确认消息，表示连接已建立。此时客户端和服务器已经完成三次握手，连接已经建立，可以开始进行数据传输。

在三次握手过程中，客户端和服务器都会确认彼此的接收和发送能力，从而确保数据的可靠传输。若任何一方在三次握手过程中未收到对方的响应，则会认为连接建立失败，并且会重新发起连接请求。



浏览器做的第⼀步⼯作是解析 URL并⽣成 HTTP 消息，从⽽委托操作系统将消息发送给 Web 服务器。

进行域名解析，查询服务器域名对应的 IP 地址。

把 HTTP 的传输⼯作交给操作系统中的**协议栈**



# TCP/IP 网络模型

## 分层

⽹络接⼝层（链路层）的传输单位是**帧（frame）**，IP 层的传输单位是**包（packet）**，TCP 层的传输单位是**段（segment）**，HTTP 的传输单位则是**消息或报⽂（message）**。但这些名词并没有什么本质的区分，可以统称为**数据包**。

<img src="/home/alivn/Documents/算法与面试/images/Blog/计算机网络/image-20230308162748825.png" alt="image-20230308162748825" style="zoom:50%;" />

### 应用层

应⽤层（Application Layer）：应用层提供网络应用程序与网络之间的接口，主要负责处理应用程序之间的通信，⽐如 HTTP、FTP、Telnet、DNS、SMTP等。当两个不同设备的应⽤需要通信的时候，应⽤就把应⽤数据传给下⼀层，也就是传输层。

### 传输层

传输层（Transport Layer）：传输层负责将数据从一个端点传输到另一个端点，主要提供了可靠的数据传输服务，例如 TCP 和 UDP 协议。

应⽤需要传输的数据可能会⾮常⼤，如果直接传输就不好控制，因此当传输层的数据包⼤⼩超过 **MSS（TCP 最⼤报⽂段⻓度）** ，就要将数据包分块，这样即使中途有⼀个分块丢失或损坏了，只需要重新发送这⼀个分块，⽽不⽤重新发送整个数据包。在 TCP 协议中，我们把每个分块称为⼀个 TCP 段（TCP Segment）

<img src="/home/alivn/Documents/算法与面试/images/Blog/计算机网络/image-20230308155005367.png" alt="image-20230308155005367" style="zoom: 33%;" />

### 网络层

网络层（Internet Layer）：网络层负责将数据包从源主机传输到目的主机，主要提供了路由选择和转发数据包的功能，例如 IP 协议。

⽹络层最常使⽤的是 IP 协议（Internet Protocol），IP 协议会将传输层的报⽂作为数据部分，再加上 IP 包头组装成 IP 报⽂，如果 IP 报⽂⼤⼩超过 MTU（以太⽹中⼀般为 1500 字节）就会再次进⾏分⽚，得到⼀个即将发送到⽹络的 IP 报⽂。

<img src="/home/alivn/Documents/算法与面试/images/Blog/计算机网络/image-20230308160336417.png" alt="image-20230308160336417" style="zoom:50%;" />

### ⽹络接⼝层

链路层或⽹络接⼝层（Link Layer）：链路层负责将数据包从一个节点传输到另一个节点，主要提供了物理介质访问和数据帧传输的功能，例如 Ethernet 和 Wi-Fi 协议。如上图，⽣成了 IP 头部之后，接下来要交给⽹络接⼝层（Link Layer）在 IP 头部的前⾯加上 MAC 头部，并封装成数据帧（Data frame）发送到⽹络上。

MAC 头部是以太⽹使⽤的头部，它包含了接收⽅和发送⽅的 MAC 地址等信息，我们可以通过 ARP 协议获取对⽅的 MAC 地址。











# 概述

计算机网络：是一个将分散的、具有独立功能的计算机系统，通过通信设备与线路连接起来，由功能完善的
软件实现资源共享和信息传递的系统。简单地说，**计算机网络是互连的、自治的计算机集合**。

## 计算机网络的功能

- **数据通信（连通性）**。
- **资源共享。**
- 分布式处理。多台计算机各自承担同一工作任务的不同部分Hadoop平台
- 提高可靠性。替代机
- 负载均衡

## 计算机网络的组成

**按组成部分**：硬件、软件、协议

**按工作方式：**

- 边缘部分：用户直接使用。
  - C/S方式
  - P2P方式
- 核心部分：为边缘部分服务

**按功能组成：**

- 通信子网：实现资源共享功能的设备和软件的集合（应用层、表示层、会话层）

- 资源子网：实现资源共享/数据处理，各种传输介质、通信设备、相应的网络协议组成（网络层、数据链路层、物理层）

## 计算机网络的分类

**按分布范围：**广域网WAN、城域网MAN、局域网WAN、个人区域网PAN

**按使用者分：**公用网、专用网

**按交换技术分：**电路交换、报文交换、分组交换

**按拓扑结构分：**总线型、常用于广域网、星型、环型、网状型

**按传输技术分：**

- 广播式网络。共享公共通信信道
- 点对点网络。使用分组存储转发和路由选择机制

## 标准化工作

标准化对计算机网络至关重要！要实现不同厂商的硬、软件之间相互连通，必须遵从统一的标准。

标准的分类：

- 法定标准：由权威机构制定的正式的、合法的标准 (OSI)

- 事实标准：某些公司的产品在竞争中占据了主流，时间长了，这些产品中的协议和技术就成了标准(TCP/IP)

# 性能指标

## 速率相关性能指标

### 速率

速率（Rate）：即数据率或称数据传输率或比特率。连接在计算机网络上的主机在数字信道上传送**数据位数**的速率。单位是$b/s,kb/s,Mb/s,Gb/s,Tb/s$;

千 $1kb/s=10^3b/s$
兆 $1Mb/s=10^3kb/s=10^6b/s$
吉 $1Gb/s=10^3Mb/s=10^6kb/s=10^9b/s$
太 $1Tb/s=10^3Gb/s=10^6Mb/s=10^9kb/s=10^{12}b/s$

> 在表示存储容量的时候：
> $1Byte(字节)=8bit(比特)$
> $1KB=2^{10}B=1024B=1024*8b$
> $1MB=2^{10}KB=1024KB$
> $1GB=2^{10}MB=1024MB$
> $1TB=2^{10}GB=1024GB$

### 带宽

(1)“带宽”原本指某个信号具有的频带宽度，即最高频率与最低频率之差，单位是赫兹(Hz)。

(2)计算机网络中，链路带宽（Bandwidth）用来表示网络的通信线路传送数据的能力，通常是指单位时间内从网络中的某一点到另一点所能通过的**“最高数据率”**。单位是“比特每秒”，b/s,kb/s,Mb/s,Gb/s。**网络设备所支持的最高速度**。

### 吞吐量

吞吐量（Throughput）表示**在单位时间内通过某个网络（或信道、接口）的数据量**。单位b/s,kb/s,Mb/s等。吞吐量受网络的带宽或网络的额定速率的限制。

三者之间的关系：

- 链路带宽是该网络链路的最大理论传输速率
- 吞吐量是实际传输的数据量
- 速率是实际传输的速率

## 时延相关指标

### 时延

指数据（报文/分组/比特流）从网络（或链路）的一端传送到另一端所需的时间。也叫**延迟**或**迟延**。单位是s。

| 名称     | 描述                                 | 计算公式                            |
| -------- | ------------------------------------ | ----------------------------------- |
| 发送时延 | 数据从主机到信道上所用的时间         | 数据长度 / 信道带宽(发送速率)       |
| 传播时延 | 数据在信道上传播所花费的时间         | 信道长度 / 电磁波在信道上传播的速率 |
| 排队时延 | 数据在路由器前等待前面数据处理的时间 | 无计算方式                          |
| 处理时延 | 数据在路由器中处理需求的时间         | 无计算方式                          |

使用高速链路 (提高网速)，只能减小发送时延，无法减少其他三个时延。

### 时延带宽积

$$
时延带宽积(bit) = 传播时延(s)\times 带宽(bit/s)
$$

意思是链路上有多少比特的数据。

### 往返时延 RTT

往返时延 RTT：发送端发送数据开始，到发送端收到来自接收端的确认（接收端收到数据后便立即发送确认），总共经历的时延。RTT越大，在收到确认之前，可以发送的数据越多。
$$
RTT= 传播时延\times2 + 处理时间 (有时可能直接忽略)
$$

### 利用率

- **信道利用率**

$$
信道利用率 = \frac{有数据通过时间}{(有+无)数据通过时间} 
$$

- 网络利用率

$$
网络利用率 = 所有信道利用率加权求平均值
$$



- 时延和利用率的关系

随着利用率的增加，延迟也会随之增加。这是因为当利用率越高，数据包的排队和处理所需的时间就会越长，因此延迟也就越大。反之，当利用率较低时，延迟也会相应地较小。

# 分层结构
## 分层的目的

（1）发起通信的计算机必须将数据通信的通路进行激活。
（2）要告诉网络如何识别目的主机。
（3）发起通信的计算机要查明目的主机是否开机，并且与网络连接正常。
（4）发起通信的计算机要弄清楚，对方计算机中文件管理程序是否已经做好准备工作。
（5）确保差错和意外可以解决。

## 分层的基本原则

（1）各层之间**相互独立**，每层只实现一种相对独立的功能。
（2）每层之间**界面自然清晰**，易于理解，相互交流尽可能少。
（3）结构上可分割开。每层都采用**最合适的技术**来实现。
（4）保持下层对上层的独立性，**上层单向使用下层提供的服务**。
（5）整个分层结构应该能促进标准化工作。

## 认识分层结构

网络体系结构是从功能上描述计算机网络结构。每层遵循某个/些网络协议以完成本层功能。计算机网络体系结构是计算机网络的各层及其协议的集合。

**实体：**第 $n$ 层中的活动元素称为 $n$ 层实体。同一层的实体叫对等实体。

**协议：**为进行网络中的对等实体数据交换而建立的规则、标准或约定称为网络协议。【水平】

- 语法：规定传输数据的格式
- 语义：规定所要完成的功能
- 同步：规定各种操作的顺序

**接口（访问服务点SAP)：**上层使用下层服务的入口。

**服务：**下层为相邻上层提供的功能调用。【垂直】第 $n$ 层在向 $n+1$ 层提供服务时，此服务不仅包含第层本身的功能，还包含由下层服务提供的功能。



SDU服务数据单元：为完成用户所要求的功能而应传送的数据。
PC协议控制信息：控制协议操作的信息。
PDU协议数据单元：对等层次之间传送的数据单位。
